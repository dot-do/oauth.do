name = "oauth"
main = "index.ts"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]
account_id = "b6641681fe423910342b9ffa1364c76d"

# Static assets for oauth.do web UI
[assets]
directory = "./public"
binding = "ASSETS"
html_handling = "auto-trailing-slash"
not_found_handling = "single-page-application"

[vars]
WORKOS_CLIENT_ID = "client_01JQYTRXK9ZPD8JPJTKDCRB656"
REDIRECT_URI = "https://oauth.do/callback"
ALLOWED_ORIGINS = "https://oauth.do,https://collections.do,https://*.collections.do"

# Secrets (set via wrangler secret put):
# - WORKOS_API_KEY
# - WORKOS_COOKIE_PASSWORD
# - STRIPE_SECRET_KEY (optional)
# - STRIPE_WEBHOOK_SECRET (optional)

# Durable Object binding
[[durable_objects.bindings]]
name = "OAUTH_DO"
class_name = "OAuthDO"

# Durable Object migrations (required for SQLite storage)
[[migrations]]
tag = "v1"
new_sqlite_classes = ["OAuthDO"]

# KV for state storage (legacy, can be removed after migration)
[[kv_namespaces]]
binding = "OAUTH_STATE"
id = "1432072dae9c4670885bfea58c264327"

# Routes
[[routes]]
pattern = "*auth.do/*"
zone_name = "oauth.do"

[[routes]]
pattern = "oauth.do/*"
zone_name = "oauth.do"
