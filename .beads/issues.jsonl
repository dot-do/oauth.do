{"id":"oauth.do-01a","title":"Add automated key rotation","description":"SigningKeyManager.rotateKey() exists but is never called. Keys generated once and used indefinitely. Implement DO alarm-based rotation (e.g., 90 days). Old keys remain in JWKS during grace period.","status":"closed","priority":2,"issue_type":"feature","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:39:49.881276-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:08:41.737024-06:00","closed_at":"2026-02-01T16:08:41.737024-06:00","close_reason":"Duplicate of oauth.do-d5w"}
{"id":"oauth.do-05y","title":"Authenticate /register endpoint","description":"Dynamic client registration at core/src/server.ts:1079-1133 has no authentication or rate limiting. Anyone can create unlimited OAuth clients with arbitrary redirect URIs.\n\nTDD Subtasks:\n- RED: Write test that POST /register without auth returns 401\n- RED: Write test that POST /register with valid admin token succeeds\n- GREEN: Add auth requirement to /register endpoint","status":"closed","priority":1,"issue_type":"bug","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:52:11.110236-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:13:05.850023-06:00","closed_at":"2026-02-01T16:13:05.850023-06:00","close_reason":"Completed in wave 3"}
{"id":"oauth.do-070","title":"Break up server.ts monolith into separate modules","description":"core/src/server.ts is 1,781 lines containing all OAuth server logic. Extract authorization endpoint, token endpoint, callback handler, client registration, and helpers into separate Hono route group modules for testability and maintainability.","status":"open","priority":2,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:41:56.498979-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T15:41:56.498979-06:00"}
{"id":"oauth.do-085","title":"Acceptance Criteria","description":"- Tests for JWT verification with valid/invalid/expired tokens","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T15:38:15.746932-06:00","updated_at":"2026-02-01T15:40:05.642525-06:00","closed_at":"2026-02-01T15:40:05.642525-06:00","close_reason":"Closed"}
{"id":"oauth.do-0od","title":"Acceptance Criteria","description":"- README example correctly demonstrates the API","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T15:38:15.75418-06:00","updated_at":"2026-02-01T15:40:03.970279-06:00","closed_at":"2026-02-01T15:40:03.970279-06:00","close_reason":"Closed"}
{"id":"oauth.do-107","title":"TDD Subtasks","description":"- [ ] RED: Write test that request from unknown origin gets no CORS headers","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T15:38:15.743027-06:00","updated_at":"2026-02-01T15:40:06.470921-06:00","closed_at":"2026-02-01T15:40:06.470921-06:00","close_reason":"Closed"}
{"id":"oauth.do-11s","title":"Acceptance Criteria","description":"- At least 2 working example projects","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T15:38:15.754731-06:00","updated_at":"2026-02-01T15:40:03.859781-06:00","closed_at":"2026-02-01T15:40:03.859781-06:00","close_reason":"Closed"}
{"id":"oauth.do-15c","title":"Add auth worker tests","description":"workers/auth/index.ts (17KB) has ZERO tests. It handles JWT verification, API key verification, cookie sessions, and caching.\n\nTDD Subtasks:\n- RED: Test valid JWT returns valid=true with correct user\n- RED: Test expired JWT returns valid=false\n- RED: Test API key (sk_) verification\n- RED: Test admin token verification\n- RED: Test authenticate() with Authorization header\n- RED: Test authenticate() with cookie\n- RED: Test cache hit returns cached=true\n- GREEN: Verify all pass against existing implementation","status":"closed","priority":1,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:52:39.796637-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:46:20.859925-06:00","closed_at":"2026-02-01T16:46:20.859925-06:00","close_reason":"Completed in wave 9"}
{"id":"oauth.do-19w","title":"Remove duplicated API key validation","description":"API key validation against WorkOS is implemented in 3 places: workers/oauth/index.ts:162 (HTTP handler), workers/oauth/index.ts:294 (RPC method), and workers/auth/index.ts (via service binding).\n\nAcceptance: Single implementation shared across all paths.","status":"closed","priority":2,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:53:38.250157-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:18:09.028899-06:00","closed_at":"2026-02-01T16:18:09.028899-06:00","close_reason":"Completed in wave 5"}
{"id":"oauth.do-1fj","title":"TDD Subtasks","description":"- [ ] RED: Test valid JWT returns valid=true with correct user","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T15:38:15.747303-06:00","updated_at":"2026-02-01T15:40:05.516408-06:00","closed_at":"2026-02-01T15:40:05.516408-06:00","close_reason":"Closed"}
{"id":"oauth.do-1gx","title":"Document OAuth 2.1 server deployment","description":"The @dotdo/oauth server (most differentiated piece) has no deployment docs. README only covers SDK. Need deployment guide, example wrangler config, architecture diagram.","status":"closed","priority":1,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:39:18.586032-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:08:23.913732-06:00","closed_at":"2026-02-01T16:08:23.913732-06:00","close_reason":"Duplicate of oauth.do-pba"}
{"id":"oauth.do-1nf","title":"Add client credentials grant","description":"client_credentials is declared in OAuthClient.grantTypes type but the token endpoint only handles authorization_code and refresh_token. Implement for machine-to-machine auth.","status":"closed","priority":3,"issue_type":"feature","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:42:41.948931-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:41:37.34493-06:00","closed_at":"2026-02-01T16:41:37.34493-06:00","close_reason":"Completed in wave 8"}
{"id":"oauth.do-1oq","title":"Configure DO alarms for token/auth code cleanup","description":"DOSQLiteStorage has no cleanup method. CollectionsOAuthStorage has cleanup() but nothing calls it. Expired tokens and auth codes accumulate unbounded. Add periodic DO alarm to purge expired records.","status":"closed","priority":2,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:41:57.323961-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:41:37.342834-06:00","closed_at":"2026-02-01T16:41:37.342834-06:00","close_reason":"Completed in wave 8"}
{"id":"oauth.do-1y9","title":"Acceptance Criteria","description":"- Invalid token results cached briefly (e.g., 30 seconds)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T15:38:15.756504-06:00","updated_at":"2026-02-01T15:40:03.414808-06:00","closed_at":"2026-02-01T15:40:03.414808-06:00","close_reason":"Closed"}
{"id":"oauth.do-2ga","title":"Authenticate /invalidate endpoint","description":"POST /invalidate at workers/auth/index.ts:366-383 requires no authentication. Any attacker who knows a token value can invalidate its cache entry (DoS vector).\n\nAcceptance: /invalidate requires admin auth or the token itself as proof of ownership","status":"closed","priority":1,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:52:21.2707-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:15:57.769807-06:00","closed_at":"2026-02-01T16:15:57.769807-06:00","close_reason":"Completed in wave 4"}
{"id":"oauth.do-2iu","title":"Token revocation should invalidate auth cache","description":"When a token is revoked via /revoke, the auth worker's 5-minute cache still serves the old valid result. No mechanism exists for proactive cache invalidation.\n\nAcceptance: Token revocation triggers cache invalidation on auth worker. Consider RPC call from oauth worker to auth worker on revoke.","status":"closed","priority":2,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:53:29.926081-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:38:04.768941-06:00","closed_at":"2026-02-01T16:38:04.768941-06:00","close_reason":"Completed in wave 7"}
{"id":"oauth.do-2ox","title":"Add token introspection tests","description":"The /introspect endpoint is not covered in server.test.ts.\n\nTDD Subtasks:\n- RED: Test valid access token returns active: true with metadata\n- RED: Test expired token returns active: false\n- RED: Test revoked token returns active: false\n- RED: Test unknown token returns active: false\n- GREEN: Verify tests pass","status":"closed","priority":1,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:52:45.446531-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:13:05.85681-06:00","closed_at":"2026-02-01T16:13:05.85681-06:00","close_reason":"Completed in wave 3","dependencies":[{"issue_id":"oauth.do-2ox","depends_on_id":"oauth.do-ggu","type":"blocks","created_at":"2026-02-01T15:53:59.025821-06:00","created_by":"Nathan Clevenger"}]}
{"id":"oauth.do-2rc","title":"Acceptance Criteria","description":"- `/introspect` verifies JWT signature against JWKS before returning `active: true`","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T15:38:15.731974-06:00","updated_at":"2026-02-01T15:40:07.312478-06:00","closed_at":"2026-02-01T15:40:07.312478-06:00","close_reason":"Closed"}
{"id":"oauth.do-34d","title":"Remove duplicated API key validation (3 implementations)","description":"API key validation implemented 3 times: workers/oauth/index.ts:162 (HTTP), workers/oauth/index.ts:294 (RPC), workers/auth/index.ts (service binding). Extract to single shared function.","status":"closed","priority":2,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:39:50.152041-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:08:41.262116-06:00","closed_at":"2026-02-01T16:08:41.262116-06:00","close_reason":"Duplicate of oauth.do-19w"}
{"id":"oauth.do-39k","title":"Consolidate AuthUser type definitions","description":"AuthUser is defined in 6 different places with subtle differences (org vs organizationId, presence of image field). Located in: src/hono.ts, src/itty.ts, src/rpc.ts, workers/auth/src/types.ts, workers/auth/index.ts, types/mdxui-auth.d.ts.\n\nAcceptance: Single canonical AuthUser type in a shared location. All files import from the shared location.","status":"closed","priority":2,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:52:56.935662-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:21:26.51584-06:00","closed_at":"2026-02-01T16:21:26.51584-06:00","close_reason":"Completed in wave 6"}
{"id":"oauth.do-3t0","title":"Acceptance Criteria","description":"- Auth worker CORS restricts to known .do origins","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T15:38:15.742195-06:00","updated_at":"2026-02-01T15:40:06.590377-06:00","closed_at":"2026-02-01T15:40:06.590377-06:00","close_reason":"Closed"}
{"id":"oauth.do-3vb","title":"Fix release pipeline to fail on test failures","description":".github/workflows/release.yml line 42 uses 'pnpm test || true', meaning test failures do NOT block releases.\n\nAcceptance: Release pipeline fails if tests fail. Coverage thresholds enforced in CI.","status":"closed","priority":1,"issue_type":"bug","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:52:46.948956-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:08:39.387441-06:00","closed_at":"2026-02-01T16:08:39.387441-06:00","close_reason":"Fixed release pipeline in wave 1"}
{"id":"oauth.do-45j","title":"TDD Subtasks","description":"- [ ] RED: Write test that crafts a JWT with valid claims but wrong signature, asserts `active: false`","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T15:38:15.738161-06:00","updated_at":"2026-02-01T15:40:07.198437-06:00","closed_at":"2026-02-01T15:40:07.198437-06:00","close_reason":"Closed"}
{"id":"oauth.do-4ff","title":"Fix missing @dotdo/types dependency (36 type errors)","description":"src/types.ts has 8 hard imports from @dotdo/types/auth which is optional peerDependency but imported unconditionally, causing 36 of 37 type errors. Either install as regular dep or make imports conditional.","status":"closed","priority":1,"issue_type":"bug","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:39:18.296598-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:08:24.361006-06:00","closed_at":"2026-02-01T16:08:24.361006-06:00","close_reason":"Duplicate of oauth.do-oxd"}
{"id":"oauth.do-4g1","title":"Add allowlist for X-Issuer header","description":"getEffectiveIssuer() at core/src/server.ts:165-179 accepts any valid URL from the X-Issuer header. An attacker can set X-Issuer: https://evil.com and the server issues tokens with iss: https://evil.com.\n\nTDD Subtasks:\n- RED: Write test that sends X-Issuer with unauthorized domain, asserts default issuer is used\n- RED: Write test that sends X-Issuer with allowed domain, asserts it's used as issuer\n- GREEN: Add allowedIssuers config option and validate in getEffectiveIssuer()","status":"closed","priority":0,"issue_type":"bug","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:52:08.527642-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:08:38.90226-06:00","closed_at":"2026-02-01T16:08:38.90226-06:00","close_reason":"Added trustedIssuers config in wave 1"}
{"id":"oauth.do-4jh","title":"Expose all signing keys in JWKS endpoint","description":"JWKS at core/src/server.ts:335-361 only returns the current key via ensureSigningKey(). During key rotation, tokens signed with the previous key fail verification. SigningKeyManager.getAllKeys() exists but isn't used.\n\nTDD Subtasks:\n- RED: Write test that rotates key and verifies JWKS contains both old and new keys\n- GREEN: Update JWKS endpoint to use signingKeyManager.toJWKS()","status":"closed","priority":1,"issue_type":"bug","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:52:28.398837-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:15:57.75884-06:00","closed_at":"2026-02-01T16:15:57.75884-06:00","close_reason":"Completed in wave 4"}
{"id":"oauth.do-4zg","title":"Add JWT signing tests (jwt-signing.ts has ZERO tests)","description":"core/src/jwt-signing.ts implements all token signing, key generation, serialization, and JWKS export with ZERO tests. TDD: RED - test generateSigningKey produces valid RSA-2048; RED - test signAccessToken produces verifiable tokens; RED - test serialize/deserialize round-trip; RED - test exportPublicKeyToJWKS; RED - test SigningKeyManager rotation; RED - test cross-key rejection.","status":"closed","priority":0,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:38:44.886488-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T15:52:01.857163-06:00","closed_at":"2026-02-01T15:52:01.857163-06:00","close_reason":"25 jwt-signing tests written and passing"}
{"id":"oauth.do-55r","title":"Acceptance Criteria","description":"- CRUD tests for both storage implementations","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T15:38:15.747643-06:00","updated_at":"2026-02-01T15:40:05.40131-06:00","closed_at":"2026-02-01T15:40:05.40131-06:00","close_reason":"Closed"}
{"id":"oauth.do-584","title":"Add dynamic client registration authentication","description":"POST /register has no authentication and enableDynamicRegistration defaults to true. Anyone can register OAuth clients. Add optional authentication requirement or rate-limit more aggressively.","status":"closed","priority":2,"issue_type":"feature","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:42:42.807264-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:18:17.246228-06:00","closed_at":"2026-02-01T16:18:17.246228-06:00","close_reason":"Duplicates or already addressed"}
{"id":"oauth.do-5m9","title":"Remove || true from release workflow test step","description":".github/workflows/release.yml runs 'pnpm test || true' which means failing tests never block releases. Change to 'pnpm test' to make tests a hard gate.","status":"closed","priority":1,"issue_type":"bug","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:42:09.409921-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T15:52:01.707683-06:00","closed_at":"2026-02-01T15:52:01.707683-06:00","close_reason":"Removed || true, tests now block releases"}
{"id":"oauth.do-5mj","title":"Convert ClientAuthResult and VerifyResult to discriminated unions","description":"ClientAuthResult at core/src/server.ts:1176-1182 and VerifyResult at workers/auth/index.ts:41-46 use boolean flags with optional fields instead of discriminated unions, leading to non-null assertions (client!).\n\nAcceptance: Both types modeled as | { success: true; client: OAuthClient } | { success: false; error: string; ... }. Non-null assertions eliminated.","status":"closed","priority":2,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:52:59.86815-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:08:14.546065-06:00","closed_at":"2026-02-01T16:08:14.546065-06:00","close_reason":"Converted VerifyResult to discriminated union in src/rpc.ts"}
{"id":"oauth.do-5o9","title":"Implement Auth0/Okta upstream providers","description":"UpstreamOAuthConfig type supports auth0, okta, and custom providers but only workos has a concrete implementation in buildUpstreamAuthUrl and exchangeUpstreamCode. Implement the others.","status":"closed","priority":3,"issue_type":"feature","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:42:42.093735-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:49:50.890242-06:00","closed_at":"2026-02-01T16:49:50.890242-06:00","close_reason":"Completed in wave 10"}
{"id":"oauth.do-5oh","title":"Authenticate /register endpoint (open to abuse)","description":"Dynamic client registration at core/src/server.ts:1079-1133 has no auth or rate limiting. Anyone can create unlimited OAuth clients with arbitrary redirect URIs. TDD: RED - test POST /register without auth returns 401; RED - test with admin token succeeds; GREEN - add auth requirement.","status":"closed","priority":1,"issue_type":"bug","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:39:16.495394-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:08:25.765047-06:00","closed_at":"2026-02-01T16:08:25.765047-06:00","close_reason":"Duplicate of oauth.do-05y"}
{"id":"oauth.do-5qz","title":"TDD Subtasks","description":"- [ ] RED: Write storage interface conformance tests that run against all implementations","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T15:38:15.748014-06:00","updated_at":"2026-02-01T15:40:05.290744-06:00","closed_at":"2026-02-01T15:40:05.290744-06:00","close_reason":"Closed"}
{"id":"oauth.do-62z","title":"Make logout actually revoke tokens","description":"workers/oauth/index.ts:208-215 - POST /logout returns {success: true} without revoking any tokens or clearing cookies. GET /logout just redirects. No session state is invalidated.","status":"closed","priority":2,"issue_type":"bug","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:42:42.661428-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T15:52:01.172715-06:00","closed_at":"2026-02-01T15:52:01.172715-06:00","close_reason":"POST /logout now revokes tokens via DO"}
{"id":"oauth.do-6gt","title":"Acceptance Criteria","description":"- Release pipeline fails if tests fail","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T15:38:15.749509-06:00","updated_at":"2026-02-01T15:40:05.071724-06:00","closed_at":"2026-02-01T15:40:05.071724-06:00","close_reason":"Closed"}
{"id":"oauth.do-6pv","title":"Fix misleading auth() example in README","description":"README line 16-19 shows const { user, token } = await auth() but auth() returns AuthProvider (a function), not AuthResult.\n\nAcceptance: README example correctly demonstrates the API.","status":"closed","priority":1,"issue_type":"bug","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:53:19.002326-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:15:57.767551-06:00","closed_at":"2026-02-01T16:15:57.767551-06:00","close_reason":"Completed in wave 4"}
{"id":"oauth.do-6qy","title":"TDD Subtasks","description":"- [ ] RED: Test POST /device/code returns valid response","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T15:38:15.752758-06:00","updated_at":"2026-02-01T15:40:04.191452-06:00","closed_at":"2026-02-01T15:40:04.191452-06:00","close_reason":"Closed"}
{"id":"oauth.do-6uq","title":"Add working examples to examples/ directory","description":"examples/ is empty. Need: 1) protect Hono API with oauth.do, 2) deploy your own OAuth server. Both should run with minimal setup.","status":"closed","priority":2,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:39:50.016369-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:08:41.489864-06:00","closed_at":"2026-02-01T16:08:41.489864-06:00","close_reason":"Duplicate of oauth.do-lnj"}
{"id":"oauth.do-76q","title":"Replace any types in SDK code (7 instances)","description":"7 instances of 'any' in: src/auth.ts:13-14 (double as any), src/auth.ts:68 ([key:string]:any), src/auth.ts:159,162 (env as any), src/utils.ts:13 (globalThis as any), src/storage.ts:44-45,92. Replace with proper types or unknown.","status":"closed","priority":2,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:39:49.748007-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:08:41.97125-06:00","closed_at":"2026-02-01T16:08:41.97125-06:00","close_reason":"Duplicate of oauth.do-jan"}
{"id":"oauth.do-7az","title":"Make ClientAuthResult a discriminated union","description":"core/src/server.ts:1176-1182 - ClientAuthResult uses boolean success with optional fields, forcing non-null assertions at lines 1560 and 1692. Refactor to: { success: true; client: OAuthClient } | { success: false; error: string; errorDescription: string; statusCode: 400 | 401 }","status":"closed","priority":3,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:42:18.890251-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:38:04.763739-06:00","closed_at":"2026-02-01T16:38:04.763739-06:00","close_reason":"Completed in wave 7"}
{"id":"oauth.do-7ih","title":"Acceptance Criteria","description":"- `/.well-known/jwks.json` returns all keys from `signingKeyManager.getAllKeys()`","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T15:38:15.744586-06:00","updated_at":"2026-02-01T15:40:06.122473-06:00","closed_at":"2026-02-01T15:40:06.122473-06:00","close_reason":"Closed"}
{"id":"oauth.do-7kq","title":"Add tests for stripe.ts","description":"core/src/stripe.ts has ZERO test coverage. Security critical: webhook signature verification, customer management. Must verify signature verification accepts valid sigs, rejects invalid ones, and handles timing attacks.","status":"closed","priority":1,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:42:09.690762-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T15:52:01.985304-06:00","closed_at":"2026-02-01T15:52:01.985304-06:00","close_reason":"10 stripe tests written and passing"}
{"id":"oauth.do-7rk","title":"Align root tsconfig with core strict settings","description":"Root tsconfig missing 6 strict settings that core has: noUncheckedIndexedAccess, useUnknownInCatchVariables, noUnusedLocals, noUnusedParameters, noFallthroughCasesInSwitch, exactOptionalPropertyTypes.\n\nAcceptance: Root tsconfig has same strict settings as core. Type errors from stricter settings are resolved.","status":"closed","priority":2,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:53:45.644883-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:18:09.027024-06:00","closed_at":"2026-02-01T16:18:09.027024-06:00","close_reason":"Completed in wave 5"}
{"id":"oauth.do-7ut","title":"Remove legacy KV namespace binding","description":"workers/oauth/wrangler.toml:38 still declares legacy KV namespace OAUTH_STATE with comment 'can be removed after migration'.\n\nAcceptance: KV binding removed from wrangler.toml. Any remaining KV references in code removed.","status":"closed","priority":3,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:53:43.547074-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:21:26.518651-06:00","closed_at":"2026-02-01T16:21:26.518651-06:00","close_reason":"Completed in wave 6"}
{"id":"oauth.do-7y1","title":"Replace any types with unknown + type guards in src/","description":"15+ uses of 'any' in src/ directory: types.ts:106 User index sig, auth.ts:13 resolveSecret casts, auth.ts:65 login credentials, utils.ts:13 globalThis cast, storage.ts:44/92 keytar/catch. Replace with unknown and proper type guards.","status":"closed","priority":3,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:42:18.73976-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:21:34.929667-06:00","closed_at":"2026-02-01T16:21:34.929667-06:00","close_reason":"oauth.do-7y1 done in wave 6, oauth.do-8ht done in wave 6 (KV removed), oauth.do-d5w/8u4 are duplicates"}
{"id":"oauth.do-83s","title":"Fix accessTokenTtl default mismatch (48h vs documented 1h)","description":"core/src/server.ts:148 defaults to 172800 (48h) but line 65 documents default as 3600 (1h). Tests also expect 3600. Either update the default or update docs and tests.","status":"closed","priority":2,"issue_type":"bug","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:41:41.611316-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T15:52:00.693605-06:00","closed_at":"2026-02-01T15:52:00.693605-06:00","close_reason":"accessTokenTtl default restored to 3600, tests pass"}
{"id":"oauth.do-847","title":"Consider DO partitioning for scalability","description":"All OAuth requests funnel through a single Durable Object (oauth-singleton). This serializes all token issuance, has single-writer SQLite constraint, and limits geographic distribution. Consider partitioning DOs by organization or client ID.","status":"open","priority":4,"issue_type":"feature","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:41:57.187904-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T15:41:57.187904-06:00"}
{"id":"oauth.do-8bl","title":"Add auth worker tests (ZERO test coverage)","description":"workers/auth/index.ts (17KB) has ZERO tests. Handles JWT verification, API key verification, cookie sessions, caching, and AuthRPC. TDD: RED - test valid/expired/invalid JWT; RED - test API key (sk_); RED - test admin token; RED - test authenticate() with header/cookie; RED - test cache behavior.","status":"closed","priority":1,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:39:17.662502-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:08:24.961001-06:00","closed_at":"2026-02-01T16:08:24.961001-06:00","close_reason":"Duplicate of oauth.do-15c"}
{"id":"oauth.do-8g8","title":"Fix require condition pointing to ESM in package.json","description":"package.json exports require condition points to .js files but tsup only generates ESM. Breaks CJS consumers. Either remove require condition or add CJS output to tsup.","status":"closed","priority":2,"issue_type":"bug","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:39:50.289408-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:08:41.007145-06:00","closed_at":"2026-02-01T16:08:41.007145-06:00","close_reason":"Duplicate of oauth.do-d9l"}
{"id":"oauth.do-8ht","title":"Remove legacy KV namespace from wrangler.toml","description":"workers/oauth/wrangler.toml:38-39 still has OAUTH_STATE KV binding marked as legacy. Remove it to clean up configuration surface.","status":"closed","priority":4,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:41:57.458751-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:21:34.963589-06:00","closed_at":"2026-02-01T16:21:34.963589-06:00","close_reason":"oauth.do-7y1 done in wave 6, oauth.do-8ht done in wave 6 (KV removed), oauth.do-d5w/8u4 are duplicates"}
{"id":"oauth.do-8iy","title":"Remove hardcoded WorkOS client ID from SDK","description":"WorkOS client ID client_01JQYTRXK9ZPD8JPJTKDCRB656 is hardcoded in src/hono.ts:81 which is baked into the published oauth.do npm package. Make it purely configurable via options.","status":"closed","priority":2,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:42:43.084952-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:08:14.851219-06:00","closed_at":"2026-02-01T16:08:14.851219-06:00","close_reason":"Removed hardcoded WorkOS client ID, jwksUri now required"}
{"id":"oauth.do-8iz","title":"Add consent screen for third-party MCP clients","description":"When a third-party client (Claude, ChatGPT) requests access, there is no user-facing consent/approval step. The server auto-approves all authorized requests. Essential for the federated OAuth story - users need to approve what AI agents can access.","status":"open","priority":2,"issue_type":"feature","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:42:41.532091-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T15:42:41.532091-06:00"}
{"id":"oauth.do-8lq","title":"Fix open redirect in GET /logout","description":"workers/oauth/index.ts:212-215 - redirect_to query parameter is not validated. Attacker can craft https://oauth.do/logout?redirect_to=https://evil.com for phishing. Must validate against allowlist.","status":"closed","priority":1,"issue_type":"bug","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:41:41.215621-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T15:52:01.053458-06:00","closed_at":"2026-02-01T15:52:01.053458-06:00","close_reason":"redirect_to validated against ALLOWED_ORIGINS"}
{"id":"oauth.do-8u4","title":"Add automated signing key rotation via DO alarms","description":"SigningKeyManager supports rotateKey() but nothing triggers it automatically. Configure Durable Object alarms to rotate signing keys periodically (e.g., every 30 days).","status":"closed","priority":3,"issue_type":"feature","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:42:42.231814-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:21:35.023438-06:00","closed_at":"2026-02-01T16:21:35.023438-06:00","close_reason":"oauth.do-7y1 done in wave 6, oauth.do-8ht done in wave 6 (KV removed), oauth.do-d5w/8u4 are duplicates"}
{"id":"oauth.do-8xu","title":"Add SDK automatic token refresh","description":"The server handles refresh tokens but the client SDK has no automatic token refresh logic. Add silent refresh to the oauth.do npm package.","status":"closed","priority":3,"issue_type":"feature","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:42:42.506139-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:46:20.889496-06:00","closed_at":"2026-02-01T16:46:20.889496-06:00","close_reason":"Completed in wave 9"}
{"id":"oauth.do-99g","title":"Acceptance Criteria","description":"- Kid generated from public key hash or crypto random UUID","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T15:38:15.757877-06:00","updated_at":"2026-02-01T15:40:02.96942-06:00","closed_at":"2026-02-01T15:40:02.96942-06:00","close_reason":"Closed"}
{"id":"oauth.do-9sr","title":"Expose all signing keys in JWKS endpoint","description":"JWKS at core/src/server.ts:335-361 only returns current key. During rotation, tokens signed with previous key fail verification. SigningKeyManager.getAllKeys() exists but unused. TDD: RED - test rotate key then verify JWKS has both; GREEN - use signingKeyManager.toJWKS().","status":"closed","priority":1,"issue_type":"bug","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:39:17.477087-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:08:25.155825-06:00","closed_at":"2026-02-01T16:08:25.155825-06:00","close_reason":"Duplicate of oauth.do-4jh"}
{"id":"oauth.do-9y1","title":"Consolidate JWT verification into single module","description":"JWT verification is implemented independently in 3 locations with different JWKS URIs and caching: core/src/jwt.ts (Web Crypto), src/hono.ts (jose), workers/auth/index.ts (jose). The hono middleware verifies against WorkOS JWKS by default, not oauth.do's own JWKS. Create a single shared verification module.","status":"closed","priority":2,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:41:56.636076-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:18:17.225487-06:00","closed_at":"2026-02-01T16:18:17.225487-06:00","close_reason":"Duplicates or already addressed"}
{"id":"oauth.do-9zw","title":"Acceptance Criteria","description":"- KV binding removed from wrangler.toml","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T15:38:15.757541-06:00","updated_at":"2026-02-01T15:40:03.085078-06:00","closed_at":"2026-02-01T15:40:03.085078-06:00","close_reason":"Closed"}
{"id":"oauth.do-a3t","title":"Token revocation should invalidate auth cache","description":"When token revoked via /revoke, auth worker 5-min cache still serves old valid result. No mechanism for proactive invalidation. Consider RPC from oauth to auth worker on revoke.","status":"closed","priority":2,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:39:50.56187-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:08:40.589277-06:00","closed_at":"2026-02-01T16:08:40.589277-06:00","close_reason":"Duplicate of oauth.do-2iu"}
{"id":"oauth.do-agn","title":"Add allowlist for X-Issuer header","description":"getEffectiveIssuer() at core/src/server.ts:165-179 accepts any valid URL from X-Issuer header. Attacker can mint tokens with arbitrary iss claims. TDD: RED - test unauthorized X-Issuer falls back to default; RED - test allowed X-Issuer is used; GREEN - add allowedIssuers config and validate.","status":"closed","priority":0,"issue_type":"bug","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:38:44.555924-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T15:52:00.819624-06:00","closed_at":"2026-02-01T15:52:00.819624-06:00","close_reason":"X-Issuer restricted via trustedIssuers config"}
{"id":"oauth.do-ajj","title":"Acceptance Criteria","description":"- Full test coverage for `signAccessToken`, `generateSigningKey`, `serializeSigningKey`, `deserializeSigningKey`, `exportPublicKeyToJWKS`, `SigningKeyManager`","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T15:38:15.745369-06:00","updated_at":"2026-02-01T15:40:05.886323-06:00","closed_at":"2026-02-01T15:40:05.886323-06:00","close_reason":"Closed"}
{"id":"oauth.do-b2e","title":"TDD Subtasks","description":"- [ ] RED: Write test that rotates key and verifies JWKS contains both old and new keys","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T15:38:15.74501-06:00","updated_at":"2026-02-01T15:40:06.009365-06:00","closed_at":"2026-02-01T15:40:06.009365-06:00","close_reason":"Closed"}
{"id":"oauth.do-b8a","title":"Stop repurposing codeChallenge/state fields for token storage","description":"At core/src/server.ts:866-876, one-time exchange stores JWT in codeChallenge and refresh token in state. Semantic abuse risks data leakage if auth code records are logged. Create dedicated storage or separate method.","status":"closed","priority":1,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:39:17.215389-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:08:25.366958-06:00","closed_at":"2026-02-01T16:08:25.366958-06:00","close_reason":"Duplicate of oauth.do-ntq"}
{"id":"oauth.do-b9e","title":"Move Node-only exports out of main entry point","description":"Main export (oauth.do) exports FileTokenStorage, SecureFileTokenStorage, KeychainTokenStorage which require Node.js, breaking the browser-safe contract.\n\nAcceptance: Node-only storage classes only exported from oauth.do/node. Main entry point is browser-safe.","status":"closed","priority":1,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:53:16.472012-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:18:09.022656-06:00","closed_at":"2026-02-01T16:18:09.022656-06:00","close_reason":"Completed in wave 5"}
{"id":"oauth.do-bpf","title":"Update compatibility_date in wrangler.toml","description":"workers/oauth/wrangler.toml has compatibility_date = '2024-01-01' which is over 2 years old. Update to a recent date to get latest Workers runtime features and security patches.","status":"closed","priority":4,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:42:42.946089-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:38:04.770626-06:00","closed_at":"2026-02-01T16:38:04.770626-06:00","close_reason":"Completed in wave 7"}
{"id":"oauth.do-c1t","title":"Harden for Release","description":"Critical fixes and improvements needed before npm publish","status":"closed","priority":2,"issue_type":"epic","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-01-23T10:24:37.867616-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:49:50.894159-06:00","closed_at":"2026-02-01T16:49:50.894159-06:00","close_reason":"Completed in wave 10","external_ref":"gh-1"}
{"id":"oauth.do-c1t.1","title":"RED: Fix CLI auth() calls to use getUser()","description":"cli.ts lines 173, 237, 304, 332 call auth(token) but should call getUser(token)","status":"closed","priority":2,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-01-23T10:25:05.756934-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:21:26.524073-06:00","closed_at":"2026-02-01T16:21:26.524073-06:00","close_reason":"Completed in wave 6","external_ref":"gh-2","labels":["critical","red","tdd"],"dependencies":[{"issue_id":"oauth.do-c1t.1","depends_on_id":"oauth.do-c1t","type":"parent-child","created_at":"2026-01-23T10:25:05.757825-06:00","created_by":"Nathan Clevenger"}]}
{"id":"oauth.do-c1t.10","title":"GREEN: Add React component tests","description":"Add tests for OAuthDoProvider, useAuth, SignInButton, SignOutButton","status":"closed","priority":2,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-01-23T10:25:06.908082-06:00","created_by":"Nathan Clevenger","updated_at":"2026-01-23T10:37:54.239965-06:00","closed_at":"2026-01-23T10:37:54.239965-06:00","close_reason":"Closed","labels":["green","tdd","testing"],"dependencies":[{"issue_id":"oauth.do-c1t.10","depends_on_id":"oauth.do-c1t","type":"parent-child","created_at":"2026-01-23T10:25:06.908677-06:00","created_by":"Nathan Clevenger"}]}
{"id":"oauth.do-c1t.2","title":"GREEN: Add Hono middleware tests","description":"Security-critical JWT verification code is untested. Add tests for auth(), requireAuth(), apiKey(), combined()","status":"closed","priority":2,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-01-23T10:25:05.883707-06:00","created_by":"Nathan Clevenger","updated_at":"2026-01-23T10:34:54.141445-06:00","closed_at":"2026-01-23T10:34:54.141445-06:00","close_reason":"Closed","labels":["green","tdd","testing"],"dependencies":[{"issue_id":"oauth.do-c1t.2","depends_on_id":"oauth.do-c1t","type":"parent-child","created_at":"2026-01-23T10:25:05.884287-06:00","created_by":"Nathan Clevenger"}]}
{"id":"oauth.do-c1t.3","title":"RED: Fix SignOutButton to use signOut()","description":"SignOutButton directly clears localStorage instead of calling signOut() from useAuth","status":"closed","priority":2,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-01-23T10:25:06.012706-06:00","created_by":"Nathan Clevenger","updated_at":"2026-01-23T10:27:10.360165-06:00","closed_at":"2026-01-23T10:27:10.360165-06:00","close_reason":"Closed","labels":["red","tdd"],"dependencies":[{"issue_id":"oauth.do-c1t.3","depends_on_id":"oauth.do-c1t","type":"parent-child","created_at":"2026-01-23T10:25:06.013551-06:00","created_by":"Nathan Clevenger"}]}
{"id":"oauth.do-c1t.4","title":"GREEN: Add device flow tests","description":"Add tests for WorkOS device authorization flow in device.ts","status":"closed","priority":2,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-01-23T10:25:06.139557-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:41:37.349875-06:00","closed_at":"2026-02-01T16:41:37.349875-06:00","close_reason":"Completed in wave 8","external_ref":"gh-6","labels":["green","tdd","testing"],"dependencies":[{"issue_id":"oauth.do-c1t.4","depends_on_id":"oauth.do-c1t","type":"parent-child","created_at":"2026-01-23T10:25:06.140191-06:00","created_by":"Nathan Clevenger"}]}
{"id":"oauth.do-c1t.5","title":"GREEN: Add login module tests","description":"Add tests for token refresh logic and singleton pattern in login.ts","status":"closed","priority":2,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-01-23T10:25:06.265311-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:41:37.351799-06:00","closed_at":"2026-02-01T16:41:37.351799-06:00","close_reason":"Completed in wave 8","external_ref":"gh-7","labels":["green","tdd","testing"],"dependencies":[{"issue_id":"oauth.do-c1t.5","depends_on_id":"oauth.do-c1t","type":"parent-child","created_at":"2026-01-23T10:25:06.265949-06:00","created_by":"Nathan Clevenger"}]}
{"id":"oauth.do-c1t.6","title":"REFACTOR: Extract shared getEnv utility","description":"getEnv() is duplicated in auth.ts, config.ts, storage.ts - extract to shared module","status":"closed","priority":2,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-01-23T10:25:06.408492-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:46:20.921868-06:00","closed_at":"2026-02-01T16:46:20.921868-06:00","close_reason":"Completed in wave 9","external_ref":"gh-8","labels":["refactor","tdd"],"dependencies":[{"issue_id":"oauth.do-c1t.6","depends_on_id":"oauth.do-c1t","type":"parent-child","created_at":"2026-01-23T10:25:06.409096-06:00","created_by":"Nathan Clevenger"}]}
{"id":"oauth.do-c1t.7","title":"REFACTOR: Add types export to package.json","description":"Add ./types export for type-only imports","status":"closed","priority":2,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-01-23T10:25:06.534176-06:00","created_by":"Nathan Clevenger","updated_at":"2026-01-23T10:32:08.971145-06:00","closed_at":"2026-01-23T10:32:08.971145-06:00","close_reason":"Closed","labels":["refactor","tdd"],"dependencies":[{"issue_id":"oauth.do-c1t.7","depends_on_id":"oauth.do-c1t","type":"parent-child","created_at":"2026-01-23T10:25:06.534923-06:00","created_by":"Nathan Clevenger"}]}
{"id":"oauth.do-c1t.8","title":"GREEN: Add CI/CD GitHub Actions","description":"Add .github/workflows/test.yml for automated testing on PR/push","status":"closed","priority":2,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-01-23T10:25:06.657337-06:00","created_by":"Nathan Clevenger","updated_at":"2026-01-23T10:32:09.056574-06:00","closed_at":"2026-01-23T10:32:09.056574-06:00","close_reason":"Closed","labels":["ci","green","tdd"],"dependencies":[{"issue_id":"oauth.do-c1t.8","depends_on_id":"oauth.do-c1t","type":"parent-child","created_at":"2026-01-23T10:25:06.65792-06:00","created_by":"Nathan Clevenger"}]}
{"id":"oauth.do-c1t.9","title":"REFACTOR: Update README documentation","description":"Add intro section, Getting Started guide, document GitHub Device Flow, document duckdb-auth","status":"closed","priority":2,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-01-23T10:25:06.783612-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:46:20.913706-06:00","closed_at":"2026-02-01T16:46:20.913706-06:00","close_reason":"Completed in wave 9","external_ref":"gh-11","labels":["docs","refactor","tdd"],"dependencies":[{"issue_id":"oauth.do-c1t.9","depends_on_id":"oauth.do-c1t","type":"parent-child","created_at":"2026-01-23T10:25:06.784205-06:00","created_by":"Nathan Clevenger"}]}
{"id":"oauth.do-car","title":"Move Node-only exports out of main entry point","description":"Main export (oauth.do) exports FileTokenStorage, SecureFileTokenStorage, KeychainTokenStorage which require Node.js, breaking the browser-safe contract. Should only be in oauth.do/node.","status":"closed","priority":1,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:39:18.879246-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:08:23.519388-06:00","closed_at":"2026-02-01T16:08:23.519388-06:00","close_reason":"Duplicate of oauth.do-b9e"}
{"id":"oauth.do-ccl","title":"Fix JWT signature verification in introspection endpoint","description":"core/src/server.ts:404 - The /introspect endpoint decodes JWTs but skips signature verification. Any well-formed JWT is reported as active:true. The signing key is available in the same DO - must verify signatures against JWKS.","status":"closed","priority":0,"issue_type":"bug","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:41:40.697013-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T15:52:00.346871-06:00","closed_at":"2026-02-01T15:52:00.346871-06:00","close_reason":"JWT signature verification added to /introspect endpoint"}
{"id":"oauth.do-cgt","title":"Cache negative token verification results","description":"workers/auth/index.ts:296-299 only caches valid results. Invalid tokens force expensive verification on every request (DoS vector).\n\nAcceptance: Invalid token results cached briefly (e.g., 30 seconds). Cache eviction works correctly for both positive and negative results.","status":"closed","priority":2,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:53:27.739764-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:38:04.767109-06:00","closed_at":"2026-02-01T16:38:04.767109-06:00","close_reason":"Completed in wave 7"}
{"id":"oauth.do-cih","title":"Acceptance Criteria","description":"- Single implementation shared across all paths","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T15:38:15.755165-06:00","updated_at":"2026-02-01T15:40:03.753149-06:00","closed_at":"2026-02-01T15:40:03.753149-06:00","close_reason":"Closed"}
{"id":"oauth.do-d5w","title":"Add automated key rotation","description":"SigningKeyManager.rotateKey() exists but is never called. Keys are generated once and used indefinitely.\n\nAcceptance: DO alarm-based rotation schedule (e.g., every 90 days). Old keys remain in JWKS during grace period. Rotation is logged.","status":"closed","priority":2,"issue_type":"feature","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:53:10.336703-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:21:34.996235-06:00","closed_at":"2026-02-01T16:21:34.996235-06:00","close_reason":"oauth.do-7y1 done in wave 6, oauth.do-8ht done in wave 6 (KV removed), oauth.do-d5w/8u4 are duplicates"}
{"id":"oauth.do-d9l","title":"Remove require condition pointing to ESM in package.json","description":"package.json exports require condition pointing to .js files but tsup only generates ESM, breaking CJS consumers.\n\nAcceptance: Either remove require condition or add CJS output format to tsup.","status":"closed","priority":2,"issue_type":"bug","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:53:24.312791-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:13:05.845661-06:00","closed_at":"2026-02-01T16:13:05.845661-06:00","close_reason":"Completed in wave 3"}
{"id":"oauth.do-die","title":"Acceptance Criteria","description":"- `/invalidate` requires admin auth or the token itself as proof of ownership","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T15:38:15.743459-06:00","updated_at":"2026-02-01T15:40:06.350421-06:00","closed_at":"2026-02-01T15:40:06.350421-06:00","close_reason":"Closed"}
{"id":"oauth.do-e3k","title":"Fix auth worker dependency mismatch","description":"workers/auth/package.json lists @tsndr/cloudflare-worker-jwt as dependency but workers/auth/index.ts imports from jose. Update package.json to list jose.","status":"closed","priority":2,"issue_type":"bug","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:41:56.908802-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T15:52:01.441725-06:00","closed_at":"2026-02-01T15:52:01.441725-06:00","close_reason":"Replaced @tsndr/cloudflare-worker-jwt with jose"}
{"id":"oauth.do-e6t","title":"Remove token from query parameter support","description":"workers/auth/index.ts:317-318,336-337 accepts tokens via query parameters. Tokens in URLs are logged in access logs, browser history, and referer headers.\n\nAcceptance: Token verification only accepts tokens via POST body or Authorization header. Query parameter support removed from /verify endpoint.","status":"closed","priority":2,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:53:32.25806-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:13:05.852617-06:00","closed_at":"2026-02-01T16:13:05.852617-06:00","close_reason":"Completed in wave 3"}
{"id":"oauth.do-e88","title":"Add production storage backend tests","description":"DOSQLiteStorage and CollectionsOAuthStorage have ZERO tests. Only MemoryOAuthStorage tested. TDD: RED - write storage conformance tests; GREEN - verify all 3 implementations pass. Cover CRUD, auth code single-use, token revocation, SQL injection resistance.","status":"closed","priority":1,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:39:17.845696-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:08:24.755023-06:00","closed_at":"2026-02-01T16:08:24.755023-06:00","close_reason":"Duplicate of oauth.do-r0v"}
{"id":"oauth.do-eaj","title":"Restrict X-Issuer header to trusted callers","description":"core/src/server.ts:165-179 - Any external caller can set X-Issuer to cause tokens to be issued with an arbitrary issuer. No allowlist or authentication. Should require authentication or restrict to trusted callers only.","status":"closed","priority":1,"issue_type":"bug","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:41:40.957569-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T15:52:00.817434-06:00","closed_at":"2026-02-01T15:52:00.817434-06:00","close_reason":"X-Issuer restricted via trustedIssuers config"}
{"id":"oauth.do-ek2","title":"Add JWT signing tests (jwt-signing.ts)","description":"core/src/jwt-signing.ts has ZERO tests. This file implements all token signing, key generation, serialization, and JWKS export.\n\nTDD Subtasks:\n- RED: Test generateSigningKey produces valid RSA-2048 key pair\n- RED: Test signAccessToken produces tokens that can be verified\n- RED: Test serialize/deserialize round-trips correctly\n- RED: Test exportPublicKeyToJWKS produces valid JWKS format\n- RED: Test SigningKeyManager key rotation\n- RED: Test token signed with key A is rejected by key B\n- GREEN: All tests pass (implementation already exists)","status":"closed","priority":0,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:52:32.943508-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:08:38.660607-06:00","closed_at":"2026-02-01T16:08:38.660607-06:00","close_reason":"Added 25 jwt-signing tests in wave 1"}
{"id":"oauth.do-f5v","title":"Acceptance Criteria","description":"- All `any` types replaced with proper types or `unknown` with type guards","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T15:38:15.751673-06:00","updated_at":"2026-02-01T15:40:04.520448-06:00","closed_at":"2026-02-01T15:40:04.520448-06:00","close_reason":"Closed"}
{"id":"oauth.do-f60","title":"Add scope enforcement","description":"Scopes are passed through tokens but never validated or restricted per client. Should validate requested scopes against client allowed scopes and user grants.","status":"closed","priority":2,"issue_type":"feature","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:42:41.669161-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:08:14.003591-06:00","closed_at":"2026-02-01T16:08:14.003591-06:00","close_reason":"Added scope validation on /authorize and /login endpoints"}
{"id":"oauth.do-f7e","title":"Use cryptographic key ID instead of timestamp","description":"core/src/jwt-signing.ts:86 uses Date.now() for kid. Keys generated in same millisecond get same kid. Should use hash of public key or UUID.\n\nAcceptance: Kid generated from public key hash or crypto random UUID.","status":"closed","priority":3,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:53:41.065587-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:21:26.521141-06:00","closed_at":"2026-02-01T16:21:26.521141-06:00","close_reason":"Completed in wave 6"}
{"id":"oauth.do-faa","title":"Consolidate AuthUser type definitions (6 duplicates)","description":"AuthUser defined in 6 places with subtle differences (org vs organizationId, image field). Located in: src/hono.ts, src/itty.ts, src/rpc.ts, workers/auth/src/types.ts, workers/auth/index.ts, types/mdxui-auth.d.ts. Create single canonical type.","status":"closed","priority":2,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:39:49.337618-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:08:42.431647-06:00","closed_at":"2026-02-01T16:08:42.431647-06:00","close_reason":"Duplicate of oauth.do-39k"}
{"id":"oauth.do-fji","title":"Acceptance Criteria","description":"- Exchange codes use dedicated storage fields or a separate storage method","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T15:38:15.744194-06:00","updated_at":"2026-02-01T15:40:06.237612-06:00","closed_at":"2026-02-01T15:40:06.237612-06:00","close_reason":"Closed"}
{"id":"oauth.do-fu6","title":"Add admin API and dashboard","description":"No way to manage users, clients, or tokens except through direct storage access. Build admin API endpoints and web UI for managing OAuth resources.","status":"open","priority":4,"issue_type":"feature","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:42:42.37172-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T15:42:42.37172-06:00"}
{"id":"oauth.do-g5b","title":"Align root tsconfig with core strict settings","description":"Root tsconfig missing 6 strict settings that core has: noUncheckedIndexedAccess, useUnknownInCatchVariables, noUnusedLocals, noUnusedParameters, noFallthroughCasesInSwitch, exactOptionalPropertyTypes.","status":"closed","priority":2,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:39:49.599544-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:08:42.210785-06:00","closed_at":"2026-02-01T16:08:42.210785-06:00","close_reason":"Duplicate of oauth.do-7rk"}
{"id":"oauth.do-g9l","title":"Fix 3 failing tests (expires_in 3600 vs 172800)","description":"3 tests fail because accessTokenTtl was changed from 3600 to 172800 but test assertions not updated: core/src/dev.test.ts:142, core/src/server.test.ts:166, core/src/server.test.ts:355. Fix assertions or revert the default.","status":"closed","priority":1,"issue_type":"bug","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:42:09.261428-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T15:52:00.695819-06:00","closed_at":"2026-02-01T15:52:00.695819-06:00","close_reason":"accessTokenTtl default restored to 3600, tests pass"}
{"id":"oauth.do-ggu","title":"Verify JWT signatures in introspection endpoint","description":"The /introspect endpoint at core/src/server.ts:383-416 decodes JWTs and returns active: true without verifying the cryptographic signature. An attacker can craft a JWT with arbitrary claims and the introspection endpoint will report it as active.\n\nTDD Subtasks:\n- RED: Write test that crafts a JWT with valid claims but wrong signature, asserts active: false\n- RED: Write test that verifies valid signed JWT returns active: true with correct metadata\n- GREEN: Implement signature verification using signingKeyManager in introspect handler\n- GREEN: Verify expired signed token returns active: false","status":"closed","priority":0,"issue_type":"bug","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:52:04.866684-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:08:39.144487-06:00","closed_at":"2026-02-01T16:08:39.144487-06:00","close_reason":"Added JWT signature verification to /introspect in wave 1"}
{"id":"oauth.do-gr6","title":"Acceptance Criteria","description":"- Node-only storage classes only exported from `oauth.do/node`","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T15:38:15.755795-06:00","updated_at":"2026-02-01T15:40:03.638754-06:00","closed_at":"2026-02-01T15:40:03.638754-06:00","close_reason":"Closed"}
{"id":"oauth.do-h20","title":"Add verifyJWT function for server-side token validation","description":"Add verifyJWT function to @dotdo/oauth that bashx.do and other projects expect. Should support JWKS URL for key fetching and standard JWT claims validation. Export from oauth.do/server subpath.","status":"closed","priority":1,"issue_type":"feature","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-01-24T12:06:53.914899-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:15:57.765635-06:00","closed_at":"2026-02-01T16:15:57.765635-06:00","close_reason":"Completed in wave 4","external_ref":"gh-12"}
{"id":"oauth.do-hh3","title":"Verify JWT signatures in introspection endpoint","description":"The /introspect endpoint at core/src/server.ts:383-416 decodes JWTs and returns active:true without verifying the cryptographic signature. An attacker can craft a JWT with arbitrary claims and introspection will report it as active. TDD: RED - test forged JWT returns active:false; RED - test valid signed JWT returns active:true; GREEN - implement signature verification using signingKeyManager.","status":"closed","priority":0,"issue_type":"bug","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:38:44.308986-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T15:52:00.348988-06:00","closed_at":"2026-02-01T15:52:00.348988-06:00","close_reason":"JWT signature verification added to /introspect endpoint"}
{"id":"oauth.do-hl4","title":"Cache negative token verification results","description":"workers/auth/index.ts:296-299 only caches valid results. Invalid tokens force expensive verification every request (DoS vector). Cache negative results briefly (30s).","status":"closed","priority":2,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:39:50.43003-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:08:40.787637-06:00","closed_at":"2026-02-01T16:08:40.787637-06:00","close_reason":"Duplicate of oauth.do-cgt"}
{"id":"oauth.do-hmi","title":"Fix release pipeline to fail on test failures","description":".github/workflows/release.yml line 42 uses 'pnpm test || true', meaning test failures do NOT block releases. Change to 'pnpm test'. Also add coverage threshold enforcement in CI.","status":"closed","priority":1,"issue_type":"bug","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:39:18.138892-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T15:52:01.710368-06:00","closed_at":"2026-02-01T15:52:01.710368-06:00","close_reason":"Removed || true, tests now block releases"}
{"id":"oauth.do-iqv","title":"Fix missing .js extension in session-hono.ts imports","description":"src/session-hono.ts:24-25 imports from './session' without .js extension, inconsistent with all other source files that use .js extensions for ESM compatibility.","status":"closed","priority":4,"issue_type":"bug","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:42:19.200691-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:13:14.208507-06:00","closed_at":"2026-02-01T16:13:14.208507-06:00","close_reason":"Fixed in wave 2"}
{"id":"oauth.do-iz7","title":"Fix timingSafeEqual length leak","description":"core/src/stripe.ts:404-415 and core/src/pkce.ts:133-135 - timingSafeEqual/constantTimeEqual returns false immediately when lengths differ, leaking the length of the expected value via timing.","status":"closed","priority":2,"issue_type":"bug","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:41:41.47705-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T15:52:00.57823-06:00","closed_at":"2026-02-01T15:52:00.57823-06:00","close_reason":"timingSafeEqual no longer leaks length"}
{"id":"oauth.do-j2k","title":"Acceptance Criteria","description":"- Both types modeled as `| { success: true; client: OAuthClient } | { success: false; error: string; ... }`","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T15:38:15.750958-06:00","updated_at":"2026-02-01T15:40:04.739021-06:00","closed_at":"2026-02-01T15:40:04.739021-06:00","close_reason":"Closed"}
{"id":"oauth.do-jan","title":"Replace any types in SDK code","description":"7 instances of any in SDK code: src/auth.ts:13-14 (double as any), src/auth.ts:68 ([key: string]: any), src/auth.ts:159,162 (env as any), src/utils.ts:13 (globalThis as any), src/storage.ts:44-45,92.\n\nAcceptance: All any types replaced with proper types or unknown with type guards.","status":"closed","priority":2,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:53:03.332474-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:21:26.512746-06:00","closed_at":"2026-02-01T16:21:26.512746-06:00","close_reason":"Completed in wave 6"}
{"id":"oauth.do-jl2","title":"Fix misleading auth() example in README","description":"README line 16-19 shows 'const { user, token } = await auth()' but auth() returns AuthProvider (a function), not AuthResult.","status":"closed","priority":1,"issue_type":"bug","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:39:18.730303-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:08:23.721466-06:00","closed_at":"2026-02-01T16:08:23.721466-06:00","close_reason":"Duplicate of oauth.do-6pv"}
{"id":"oauth.do-jr4","title":"Stop overloading auth code fields for token storage","description":"core/src/server.ts:871-876 - One-time exchange stores JWT in codeChallenge field and refresh token in state field. Semantic misuse that is confusing and fragile. Create a dedicated data structure or extend the storage interface.","status":"closed","priority":2,"issue_type":"bug","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:41:41.347635-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:08:40.105431-06:00","closed_at":"2026-02-01T16:08:40.105431-06:00","close_reason":"Duplicate of oauth.do-ntq"}
{"id":"oauth.do-kcc","title":"Acceptance Criteria","description":"- Either remove `require` condition or add CJS output format to tsup","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T15:38:15.756161-06:00","updated_at":"2026-02-01T15:40:03.527921-06:00","closed_at":"2026-02-01T15:40:03.527921-06:00","close_reason":"Closed"}
{"id":"oauth.do-krs","title":"Acceptance Criteria","description":"- Token revocation triggers cache invalidation on auth worker","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T15:38:15.756881-06:00","updated_at":"2026-02-01T15:40:03.305562-06:00","closed_at":"2026-02-01T15:40:03.305562-06:00","close_reason":"Closed"}
{"id":"oauth.do-l0o","title":"Remove legacy KV namespace binding","description":"workers/oauth/wrangler.toml:38 still declares legacy KV namespace OAUTH_STATE with comment 'can be removed after migration'. Remove binding and any remaining KV references.","status":"closed","priority":3,"issue_type":"chore","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:39:50.830266-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:18:17.201682-06:00","closed_at":"2026-02-01T16:18:17.201682-06:00","close_reason":"Duplicates or already addressed"}
{"id":"oauth.do-lkq","title":"Remove duplicate wrangler config for auth worker","description":"workers/auth/ has both wrangler.toml and wrangler.jsonc with different compatibility_date values (2024-01-01 vs 2026-01-25) and the jsonc has nodejs_compat while toml does not. Choose one and delete the other.","status":"closed","priority":3,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:41:57.046145-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T15:52:01.568613-06:00","closed_at":"2026-02-01T15:52:01.568613-06:00","close_reason":"Deleted wrangler.toml, kept wrangler.jsonc"}
{"id":"oauth.do-lkr","title":"Acceptance Criteria","description":"- Single canonical `AuthUser` type in a shared location","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T15:38:15.750606-06:00","updated_at":"2026-02-01T15:40:04.851914-06:00","closed_at":"2026-02-01T15:40:04.851914-06:00","close_reason":"Closed"}
{"id":"oauth.do-lnj","title":"Add working examples to examples/ directory","description":"examples/ directory is empty. Need at minimum: protect my Hono API and deploy your own OAuth server examples.\n\nAcceptance: At least 2 working example projects. Examples run with minimal setup.","status":"open","priority":2,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:53:53.681281-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T15:53:53.681281-06:00"}
{"id":"oauth.do-lp1","title":"Use cryptographic key ID instead of timestamp","description":"core/src/jwt-signing.ts:86 uses Date.now() for kid. Keys in same millisecond get same kid. Use hash of public key or crypto random UUID.","status":"closed","priority":3,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:39:50.970165-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:18:17.176777-06:00","closed_at":"2026-02-01T16:18:17.176777-06:00","close_reason":"Duplicates or already addressed"}
{"id":"oauth.do-neq","title":"Acceptance Criteria","description":"- `/register` requires admin token or valid auth","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T15:38:15.741465-06:00","updated_at":"2026-02-01T15:40:06.824575-06:00","closed_at":"2026-02-01T15:40:06.824575-06:00","close_reason":"Closed"}
{"id":"oauth.do-nso","title":"Add tests for jwt-signing.ts","description":"core/src/jwt-signing.ts has ZERO test coverage. Security critical: RSA key generation, serialization, JWKS export, key rotation. Must verify key sizes, algorithms, serialization roundtrips, and JWKS format compliance with RFC 7517.","status":"closed","priority":1,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:42:09.5503-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T15:52:01.854095-06:00","closed_at":"2026-02-01T15:52:01.854095-06:00","close_reason":"25 jwt-signing tests written and passing"}
{"id":"oauth.do-ntq","title":"Stop repurposing codeChallenge/state fields for token storage","description":"At core/src/server.ts:866-876, the one-time exchange flow stores JWT in codeChallenge field and refresh token in state field. This semantic abuse risks data leakage if auth code records are logged.\n\nAcceptance: Exchange codes use dedicated storage fields or a separate storage method. No sensitive tokens stored in fields designed for non-secret data.","status":"closed","priority":1,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:52:26.249034-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:15:57.762682-06:00","closed_at":"2026-02-01T16:15:57.762682-06:00","close_reason":"Completed in wave 4"}
{"id":"oauth.do-nv4","title":"Acceptance Criteria","description":"- `POST /device/code` endpoint returns device_code, user_code, verification_uri","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T15:38:15.7524-06:00","updated_at":"2026-02-01T15:40:04.30137-06:00","closed_at":"2026-02-01T15:40:04.30137-06:00","close_reason":"Closed"}
{"id":"oauth.do-o3i","title":"Fix Stripe webhook signature verification","description":"core/src/stripe.ts:300-324 - constructEvent parses the Stripe signature header and checks timestamp but never verifies the HMAC signature. The _secret parameter is unused. Any request with a valid-looking Stripe-Signature header will be accepted.","status":"closed","priority":0,"issue_type":"bug","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:41:40.827939-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T15:52:00.467781-06:00","closed_at":"2026-02-01T15:52:00.467781-06:00","close_reason":"Stripe webhook HMAC signature verification implemented"}
{"id":"oauth.do-o8h","title":"Create shared tsconfig.base.json with strict settings","description":"core/tsconfig.json has excellent strictness (exactOptionalPropertyTypes, noUncheckedIndexedAccess, etc) but root and workers configs are weaker. Create a shared tsconfig.base.json with core-level strictness and extend it everywhere.","status":"closed","priority":3,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:42:18.595482-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:38:04.7654-06:00","closed_at":"2026-02-01T16:38:04.7654-06:00","close_reason":"Completed in wave 7"}
{"id":"oauth.do-odh","title":"Make VerifyResult a discriminated union","description":"src/rpc.ts:60-69 - VerifyResult uses boolean valid with optional fields. Refactor to: { valid: true; user: AuthUser; cached?: boolean } | { valid: false; error: string }","status":"closed","priority":3,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:42:19.045394-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:08:49.972166-06:00","closed_at":"2026-02-01T16:08:49.972166-06:00","close_reason":"Done in wave 2"}
{"id":"oauth.do-oxd","title":"Fix missing @dotdo/types dependency","description":"src/types.ts has 8 hard imports from @dotdo/types/auth which is listed as optional peerDependency but imported unconditionally, causing 36 type errors.\n\nAcceptance: Either install @dotdo/types as regular dependency or make imports conditional. npx tsc --noEmit passes for the root package.","status":"closed","priority":1,"issue_type":"bug","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:52:53.020762-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:18:09.025379-06:00","closed_at":"2026-02-01T16:18:09.025379-06:00","close_reason":"Completed in wave 5"}
{"id":"oauth.do-pba","title":"Document OAuth 2.1 server deployment","description":"The @dotdo/oauth server (most differentiated piece) has no deployment documentation. The README only covers the SDK.\n\nAcceptance: Deployment guide for self-hosting the OAuth 2.1 server. Example wrangler config for third-party deployment. Architecture diagram.","status":"closed","priority":1,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:53:50.966626-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:49:50.888335-06:00","closed_at":"2026-02-01T16:49:50.888335-06:00","close_reason":"Completed in wave 10"}
{"id":"oauth.do-pc3","title":"Acceptance Criteria","description":"- X-Issuer only accepts URLs from an explicit allowlist","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T15:38:15.738958-06:00","updated_at":"2026-02-01T15:40:07.076249-06:00","closed_at":"2026-02-01T15:40:07.076249-06:00","close_reason":"Closed"}
{"id":"oauth.do-ppm","title":"Restrict CORS on auth worker","description":"Auth worker at workers/auth/index.ts:310 uses fully open CORS. Combined with cookie-based auth on /me, any website can make credentialed requests. TDD: RED - test unknown origin gets no CORS; RED - test allowed origin gets headers; GREEN - configure CORS with explicit list.","status":"closed","priority":1,"issue_type":"bug","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:39:16.669297-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T15:52:01.293479-06:00","closed_at":"2026-02-01T15:52:01.293479-06:00","close_reason":"Auth worker CORS restricted to ALLOWED_ORIGINS"}
{"id":"oauth.do-pxh","title":"Add authentication to /exchange endpoint","description":"core/src/server.ts:1041-1069 - The /exchange endpoint accepts a one-time code and returns access+refresh tokens with no client authentication, no origin checking. If the one-time code is intercepted (60s window), any party can exchange it.","status":"closed","priority":1,"issue_type":"bug","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:41:41.083854-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T15:52:00.92999-06:00","closed_at":"2026-02-01T15:52:00.92999-06:00","close_reason":"Origin validation added to /exchange endpoint"}
{"id":"oauth.do-qdz","title":"Add /userinfo endpoint (OpenID Connect)","description":"No /userinfo endpoint per OpenID Connect spec. Needed for OIDC compatibility alongside the existing OAuth 2.1 endpoints.","status":"closed","priority":2,"issue_type":"feature","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:42:41.810494-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:08:13.735018-06:00","closed_at":"2026-02-01T16:08:13.735018-06:00","close_reason":"Added /userinfo endpoint with OIDC-compliant scope-based claim filtering"}
{"id":"oauth.do-qwi","title":"Remove token from query parameter support","description":"workers/auth/index.ts:317-318,336-337 accepts tokens via query params. Tokens in URLs logged in access logs, browser history, referer headers. Only accept via POST body or Authorization header.","status":"closed","priority":2,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:39:50.693319-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:08:40.369974-06:00","closed_at":"2026-02-01T16:08:40.369974-06:00","close_reason":"Duplicate of oauth.do-e6t"}
{"id":"oauth.do-r0v","title":"Add production storage backend tests","description":"DOSQLiteStorage and CollectionsOAuthStorage are production storage backends with ZERO tests. Only MemoryOAuthStorage is tested.\n\nTDD Subtasks:\n- RED: Write storage interface conformance tests that run against all implementations\n- GREEN: Verify MemoryOAuthStorage passes (already does)\n- GREEN: Verify DOSQLiteStorage passes\n- GREEN: Verify CollectionsOAuthStorage passes","status":"closed","priority":1,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:52:42.153376-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:49:50.891597-06:00","closed_at":"2026-02-01T16:49:50.891597-06:00","close_reason":"Completed in wave 10"}
{"id":"oauth.do-r1d","title":"Authenticate /invalidate endpoint","description":"POST /invalidate at workers/auth/index.ts:366-383 requires no auth. Any attacker who knows a token can invalidate its cache (DoS vector). Require admin auth or token ownership proof.","status":"closed","priority":1,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:39:16.91023-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:08:25.553981-06:00","closed_at":"2026-02-01T16:08:25.553981-06:00","close_reason":"Duplicate of oauth.do-2ga"}
{"id":"oauth.do-r8w","title":"TDD Subtasks","description":"- [ ] RED: Test generateSigningKey produces valid RSA-2048 key pair","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T15:38:15.746542-06:00","updated_at":"2026-02-01T15:40:05.76738-06:00","closed_at":"2026-02-01T15:40:05.76738-06:00","close_reason":"Closed"}
{"id":"oauth.do-sqc","title":"Acceptance Criteria","description":"- DO alarm-based rotation schedule (e.g., every 90 days)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T15:38:15.752046-06:00","updated_at":"2026-02-01T15:40:04.412862-06:00","closed_at":"2026-02-01T15:40:04.412862-06:00","close_reason":"Closed"}
{"id":"oauth.do-t7o","title":"Add tests for storage-do.ts","description":"core/src/storage-do.ts has ZERO test coverage. Data integrity critical: all CRUD operations for users, clients, tokens, auth codes in SQLite. Use a mock SqlStorage to test all operations and verify SQL parameterization.","status":"closed","priority":2,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:42:09.829961-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:08:14.250908-06:00","closed_at":"2026-02-01T16:08:14.250908-06:00","close_reason":"Added comprehensive storage-do.test.ts with 40+ tests"}
{"id":"oauth.do-trq","title":"TDD Subtasks","description":"- [ ] RED: Write test that POST /register without auth returns 401","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T15:38:15.741856-06:00","updated_at":"2026-02-01T15:40:06.70802-06:00","closed_at":"2026-02-01T15:40:06.70802-06:00","close_reason":"Closed"}
{"id":"oauth.do-ufh","title":"TDD Subtasks","description":"- [ ] RED: Test valid access token returns `active: true` with metadata","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T15:38:15.748986-06:00","updated_at":"2026-02-01T15:40:05.181002-06:00","closed_at":"2026-02-01T15:40:05.181002-06:00","close_reason":"Closed"}
{"id":"oauth.do-ukv","title":"Add worker integration tests with @cloudflare/vitest-pool-workers","description":"workers/oauth/ and workers/auth/ have ZERO tests. Add @cloudflare/vitest-pool-workers for miniflare-based testing. Test the full OAuth flow through the worker: discovery -\u003e register -\u003e authorize -\u003e callback -\u003e token -\u003e introspect -\u003e revoke. Test CORS headers and error responses.","status":"open","priority":2,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:42:09.967466-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T15:42:09.967466-06:00"}
{"id":"oauth.do-v5b","title":"Add Device Authorization Grant to @dotdo/oauth server","description":"Server only supports authorization_code and refresh_token. Device Authorization Grant (RFC 8628) needed for MCP where AI clients authenticate. TDD: RED - POST /device/code returns valid response; RED - polling returns authorization_pending; RED - successful auth returns tokens; RED - expired code returns error; GREEN - implement.","status":"closed","priority":1,"issue_type":"feature","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:39:18.440009-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:08:24.133208-06:00","closed_at":"2026-02-01T16:08:24.133208-06:00","close_reason":"Duplicate of oauth.do-vpy"}
{"id":"oauth.do-v8h","title":"Acceptance Criteria","description":"- Root tsconfig has same strict settings as core","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T15:38:15.751307-06:00","updated_at":"2026-02-01T15:40:04.630728-06:00","closed_at":"2026-02-01T15:40:04.630728-06:00","close_reason":"Closed"}
{"id":"oauth.do-v8r","title":"Add CI type-checking and coverage reporting","description":"CI workflow lacks type-checking step (pnpm tsc --noEmit) and coverage upload. Add both to .github/workflows/test.yml. The vitest config already has coverage thresholds configured.","status":"closed","priority":3,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:42:10.104826-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:41:37.340778-06:00","closed_at":"2026-02-01T16:41:37.340778-06:00","close_reason":"Completed in wave 8"}
{"id":"oauth.do-vpy","title":"Add Device Authorization Grant to server","description":"@dotdo/oauth server only supports authorization_code and refresh_token grants. Device Authorization Grant (RFC 8628) is needed for MCP use case where AI clients need to authenticate.\n\nTDD Subtasks:\n- RED: Test POST /device/code returns valid response\n- RED: Test token polling returns authorization_pending\n- RED: Test successful device authorization returns tokens\n- RED: Test expired device code returns expired_token\n- GREEN: Implement device authorization grant","status":"open","priority":1,"issue_type":"feature","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:53:13.58136-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T15:53:13.58136-06:00"}
{"id":"oauth.do-vy9","title":"Acceptance Criteria","description":"- Token verification only accepts tokens via POST body or Authorization header","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T15:38:15.757216-06:00","updated_at":"2026-02-01T15:40:03.195196-06:00","closed_at":"2026-02-01T15:40:03.195196-06:00","close_reason":"Closed"}
{"id":"oauth.do-x4e","title":"Add token introspection tests","description":"The /introspect endpoint is not covered in server.test.ts. TDD: RED - valid token returns active:true; RED - expired returns active:false; RED - revoked returns active:false; RED - unknown returns active:false; GREEN - verify tests pass.","status":"closed","priority":1,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:39:17.992142-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:08:24.549909-06:00","closed_at":"2026-02-01T16:08:24.549909-06:00","close_reason":"Duplicate of oauth.do-2ox"}
{"id":"oauth.do-x74","title":"Migrate oauth.do/react to use @mdxui/auth","description":"Replace direct WorkOS AuthKit wrappers with @mdxui/auth package.\n\n## Background\n- oauth.do currently wraps @workos-inc/authkit-react directly in src/react.tsx\n- @mdxui/auth now provides unified auth components used across mdxui\n- Should consume @mdxui/auth instead of duplicating wrappers\n\n## Current implementation (to replace)\nsrc/react.tsx imports from:\n- @workos-inc/widgets (ApiKeys, UsersManagement, UserProfile)\n- @workos-inc/authkit-react (AuthKitProvider, useAuth)\n\nExports own wrappers:\n- OAuthDoProvider\n- useAuth, useOAuthDoConfig\n- SignInButton, SignOutButton\n- ApiKeys, UsersManagement, UserProfile\n\n## New implementation\nReplace with re-exports from @mdxui/auth:\n- IdentityProvider (or wrap with oauth.do config)\n- useAuth (re-export)\n- SignInButton, SignOutButton (re-export)\n- Widget components (re-export)\n\n## Benefits\n- Consistent with mdxui ecosystem\n- Less maintenance burden\n- Access to new auth components (UserMenu, TeamSwitcher, etc.)\n- Vault components will be available via same package","status":"closed","priority":1,"issue_type":"feature","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-01-25T04:15:16.799515-06:00","created_by":"Nathan Clevenger","updated_at":"2026-01-25T04:40:24.019943-06:00","closed_at":"2026-01-25T04:40:24.019943-06:00","close_reason":"Completed: Migrated oauth.do/react to use @mdxui/auth"}
{"id":"oauth.do-xe0","title":"Enforce HTTPS for redirect URIs in production","description":"No checks that redirect_uris use HTTPS. The /register endpoint accepts any URIs without validation. Should enforce HTTPS for redirect URIs in production mode.","status":"closed","priority":2,"issue_type":"feature","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:41:41.753291-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:18:09.032597-06:00","closed_at":"2026-02-01T16:18:09.032597-06:00","close_reason":"Completed in wave 5"}
{"id":"oauth.do-y0q","title":"Acceptance Criteria","description":"- Deployment guide for self-hosting the OAuth 2.1 server","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T15:38:15.753542-06:00","updated_at":"2026-02-01T15:40:04.081676-06:00","closed_at":"2026-02-01T15:40:04.081676-06:00","close_reason":"Closed"}
{"id":"oauth.do-yr8","title":"Convert ClientAuthResult and VerifyResult to discriminated unions","description":"ClientAuthResult at core/src/server.ts:1176-1182 and VerifyResult at workers/auth/index.ts:41-46 use boolean flags with optional fields. Leads to non-null assertions (client!). Model as proper discriminated unions.","status":"closed","priority":2,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:39:49.468652-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:08:39.876014-06:00","closed_at":"2026-02-01T16:08:39.876014-06:00","close_reason":"Duplicate - VerifyResult done, ClientAuthResult is P2"}
{"id":"oauth.do-yuq","title":"Acceptance Criteria","description":"- Either install `@dotdo/types` as regular dependency or make imports conditional","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T15:38:15.749954-06:00","updated_at":"2026-02-01T15:40:04.960311-06:00","closed_at":"2026-02-01T15:40:04.960311-06:00","close_reason":"Closed"}
{"id":"oauth.do-zei","title":"TDD Subtasks","description":"- [ ] RED: Write test that sends X-Issuer with unauthorized domain, asserts default issuer is used","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T15:38:15.741021-06:00","updated_at":"2026-02-01T15:40:06.95084-06:00","closed_at":"2026-02-01T15:40:06.95084-06:00","close_reason":"Closed"}
{"id":"oauth.do-zok","title":"Restrict CORS on auth worker","description":"Auth worker at workers/auth/index.ts:310 uses fully open CORS (cors()). Combined with cookie-based auth on /me, any website can make credentialed requests.\n\nTDD Subtasks:\n- RED: Write test that request from unknown origin gets no CORS headers\n- RED: Write test that request from allowed origin gets correct CORS headers\n- GREEN: Configure CORS with explicit origin list from env var","status":"closed","priority":1,"issue_type":"bug","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:52:15.110168-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:08:39.628161-06:00","closed_at":"2026-02-01T16:08:39.628161-06:00","close_reason":"Restricted CORS on auth worker in wave 1"}
{"id":"oauth.do-zvt","title":"Consolidate AuthUser type definition","description":"AuthUser is defined independently in 5 places with drift: src/hono.ts:24, src/itty.ts:22, src/rpc.ts:42, core/src/types.ts:11 (OAuthUser), src/types.ts:102 (User with any index sig). Extract to a shared module and import everywhere.","status":"closed","priority":2,"issue_type":"task","owner":"4130910+nathanclevenger@users.noreply.github.com","created_at":"2026-02-01T15:41:56.771925-06:00","created_by":"Nathan Clevenger","updated_at":"2026-02-01T16:08:23.345167-06:00","closed_at":"2026-02-01T16:08:23.345167-06:00","close_reason":"Duplicate of oauth.do-39k"}
